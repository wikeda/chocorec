# 種目マスタ機能 仕様書

## 概要

ユーザーがトレーニング種目を自由にカスタマイズできる機能。種目の追加、編集、削除、並び順変更が可能。

## 機能要件

### 1. 種目管理画面

#### 1.1 画面構成
- ヘッダー
  - 戻るボタン（左側）
  - タイトル「種目管理」（中央）
  - 追加ボタン（右側）
- 情報テキスト
  - 機能説明とガイダンス
- 種目リスト
  - 各種目アイテム
    - 色インジケーター
    - 種目名
    - 並び替えボタン（上・下）
    - 編集ボタン

#### 1.2 種目アイテム
- 色インジケーター：32x32pxの四角形、設定した色を表示
- 種目名：最大20文字
- 並び替えボタン：
  - 上ボタン：リストの上位に移動
  - 下ボタン：リストの下位に移動
  - 先頭/末尾の種目は対応するボタンが無効化
- 編集ボタン：モーダルを開く

### 2. 追加・編集モーダル

#### 2.1 入力項目
- 種目名
  - テキスト入力
  - 必須項目
  - 最大20文字
  - 重複チェックあり
- 色
  - カラーピッカー
  - テキスト入力（#xxxxxx形式）
  - 両方の入力が同期
  - デフォルト: #3b82f6（青）

#### 2.2 操作
- キャンセルボタン：モーダルを閉じる（変更を破棄）
- 保存ボタン：種目を保存
- 削除ボタン（編集時のみ）：種目を削除（確認ダイアログあり）

### 3. データ管理

#### 3.1 データ構造
```javascript
{
  exercises: [
    {
      id: string,           // UUID
      name: string,         // 種目名（最大20文字）
      color: string,        // カラーコード（#xxxxxx）
      order: number,        // 並び順（0始まり）
      isActive: boolean,    // アクティブフラグ
      createdAt: string,    // 作成日時（ISO形式）
      updatedAt: string     // 更新日時（ISO形式）
    }
  ],
  version: string           // データバージョン
}
```

#### 3.2 LocalStorage
- キー: `trainingRecExercises`
- 初回起動時に既存の9種目を自動登録

### 4. 機能詳細

#### 4.1 種目の追加
- 最大50種目まで登録可能
- 種目名の重複チェック
- 並び順は自動で末尾に設定

#### 4.2 種目の編集
- 種目名変更時：
  - 過去のトレーニング記録も新しい名前に一括更新
  - 重複チェックあり
- 色変更時：
  - グラフの色が即座に反映

#### 4.3 種目の削除
- 論理削除（isActive = false）
- 削除確認ダイアログあり
- 過去の記録は保持される
- 新規登録時には選択できなくなる
- グラフには過去データとして表示される

#### 4.4 並び順変更
- 上下ボタンで隣接する種目と順序を入れ替え
- 記録画面の種目選択リストに反映
- グラフの凡例順にも反映

### 5. 既存機能との連携

#### 5.1 記録画面
- 種目選択プルダウン
  - アクティブな種目のみ表示
  - 並び順に従って表示

#### 5.2 グラフ表示
- すべての種目（削除済みを含む）を表示
- 各種目の色を使用
- 凡例の順序は並び順に従う

#### 5.3 履歴画面
- 削除済み種目も表示
- 各種目の色を使用

#### 5.4 CSV エクスポート
- 種目名はそのまま出力
- 削除済み種目も含む

### 6. バリデーション

#### 6.1 種目名
- 必須チェック
- 最大20文字
- 重複チェック（編集時は自分自身を除く）

#### 6.2 色
- 必須チェック
- #xxxxxx形式（6桁の16進数）

#### 6.3 最大数
- 50種目まで
- 超過時はエラーメッセージ表示

### 7. 初期データ移行

#### 7.1 既存ユーザー
- 初回起動時に自動的に以下の9種目を登録
  1. レッグプレス (#ef4444)
  2. チェストプレス (#f97316)
  3. ラットプルダウン (#f59e0b)
  4. アブベンチ (#84cc16)
  5. アブダクション (#10b981)
  6. アダクション (#06b6d4)
  7. ディップス (#3b82f6)
  8. ショルダープレス (#6366f1)
  9. バイセップスカール (#8b5cf6)

#### 7.2 新規ユーザー
- 同様に9種目が初期状態

### 8. エラーハンドリング

#### 8.1 保存失敗
- LocalStorageの容量超過
- 権限エラー
→ エラーメッセージを表示

#### 8.2 重複エラー
- 同名種目が既に存在
→ 「同じ名前の種目が既に存在します」

#### 8.3 最大数超過
- 50種目を超えて追加
→ 「種目は最大50件までです」

### 9. UI/UX

#### 9.1 スマートフォン対応
- タッチ操作を考慮したボタンサイズ（最小44x44px）
- レスポンシブデザイン

#### 9.2 フィードバック
- 保存時：「種目を追加しました」「種目を更新しました」
- 削除時：確認ダイアログ + 「種目を削除しました」

#### 9.3 アクセス
- メイン画面ヘッダーの「種目」ボタンからアクセス

## 技術実装

### ファイル構成
- `exercises.html` - 種目管理画面
- `css/exercises.css` - 種目管理画面スタイル
- `js/exerciseMaster.js` - 種目マスタデータ管理
- `js/exercises.js` - 種目管理画面UI制御

### 主要関数
- `loadExercises()` - 種目データ読み込み
- `saveExercises(data)` - 種目データ保存
- `addExercise(name, color)` - 種目追加
- `updateExercise(id, updates)` - 種目更新
- `deleteExercise(id)` - 種目削除
- `moveExercise(id, direction)` - 並び順変更
- `getActiveExercises()` - アクティブな種目取得
- `getAllExercises()` - すべての種目取得
- `getExerciseColorMap()` - 色マップ取得

## 今後の拡張

- 種目のアイコン設定
- 種目のカテゴリ分類
- 種目のインポート/エクスポート
- 種目のアーカイブ（完全削除ではなく非表示）
