<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="睡眠時間を記録するスマートフォン専用アプリ">
  <title>RecSleep - 睡眠記録アプリ</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/components.css">
</head>
<body>
  <header class="header">
    <h1>RecSleep</h1>
    <a href="history.html" class="btn-history">履歴</a>
  </header>

  <main class="main">
    <!-- グラフセクション -->
    <section class="chart-section">
      <div class="chart-header">
        <div class="chart-tabs">
          <button id="week-tab" class="tab active">週次</button>
          <button id="month-tab" class="tab">月次</button>
        </div>
        <div class="chart-controls">
          <button id="week-prev-btn" class="btn-nav" onclick="moveWeekBackward()">←</button>
          <span id="week-label" class="period-label">今週</span>
          <button id="month-prev-btn" class="btn-nav hidden" onclick="moveMonthBackward()">←</button>
          <span id="month-label" class="period-label hidden">今月</span>
        </div>
      </div>
      <div id="chart-container" class="chart-container">
        <canvas id="sleep-chart"></canvas>
      </div>
    </section>
    
    <!-- 入力フォーム -->
    <section class="input-form">
      <form id="sleep-form">
        <!-- 睡眠開始日時グループ -->
        <div class="form-group">
          <label class="form-label">睡眠開始日時</label>
          <div class="form-group-row">
            <select id="date-select" name="date" class="form-select" required>
              <!-- 過去7日を動的に生成 -->
            </select>
            <select id="hour-select" name="hour" class="form-select form-select-time" required>
              <!-- 00-23を動的に生成 -->
            </select>
            <span class="separator">:</span>
            <select id="minute-select" name="minute" class="form-select form-select-time" required>
              <!-- 00-55を5分刻みで生成 -->
            </select>
          </div>
        </div>
        
        <!-- 睡眠時間グループ -->
        <div class="form-group">
          <label class="form-label">睡眠時間</label>
          <div class="form-group-row">
            <select id="duration-hour-select" name="durationHour" class="form-select form-select-time" required>
              <!-- 00-23を動的に生成 -->
            </select>
            <span class="form-unit">時間</span>
            <select id="duration-minute-select" name="durationMinute" class="form-select form-select-time" required>
              <!-- 00-55を5分刻みで生成 -->
            </select>
            <span class="form-unit">分</span>
          </div>
        </div>
        
        <!-- 記録ボタン -->
        <button type="submit" class="btn-submit">記録する</button>
      </form>
    </section>
  </main>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- JavaScript -->
  <script src="js/sleepType.js"></script>
  <script src="js/data.js"></script>
  <script src="js/validator.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/export.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Chart.jsの読み込み完了を待ってからアプリを初期化
    window.addEventListener('DOMContentLoaded', function() {
      if (typeof Chart !== 'undefined' && typeof initApp === 'function') {
        initApp();
      } else {
        // Chart.jsが読み込まれるまで待つ
        const checkChart = setInterval(function() {
          if (typeof Chart !== 'undefined' && typeof initApp === 'function') {
            clearInterval(checkChart);
            initApp();
          }
        }, 50);
        
        // タイムアウト（5秒後）
        setTimeout(function() {
          clearInterval(checkChart);
          if (typeof Chart === 'undefined') {
            console.error('Chart.js failed to load');
          } else if (typeof initApp === 'function') {
            initApp();
          } else {
            console.error('initApp is not defined');
          }
        }, 5000);
      }
    });
  </script>
</body>
</html>

