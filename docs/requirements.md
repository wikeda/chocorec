# RecSleep 要件定義書

## 1. プロジェクト概要

### 1.1 アプリケーション名
RecSleep（レックスリープ）

### 1.2 コンセプト
睡眠時間を記録するスマートフォン専用アプリケーション。昼寝を含む1日複数回の睡眠記録を想定したUIを提供する。

### 1.3 目的
- ユーザーの睡眠パターンを可視化する
- 1日複数回の睡眠（昼寝を含む）を簡単に記録できる
- スマートフォンでの操作性を重視した設計

## 2. プラットフォーム・技術仕様

### 2.1 配布方法
- GitHub Pages上で動作
- ブラウザベースのWebアプリケーション

### 2.2 データ保存
- ローカルストレージ（LocalStorage）を利用
- サーバーサイド不要、完全にクライアントサイドで完結

### 2.3 対応デバイス
- スマートフォン専用（iOS / Android）
- 主要モバイルブラウザ（Safari、Chrome、Edge等）

## 3. 機能要件

### 3.1 睡眠記録機能

#### 3.1.1 新規記録
- **睡眠開始日時選択**
  - ドロップダウン形式で選択
  - 形式：DD日 HH:MM（例：01日 14:30）
  - 日と時刻を別々のドロップダウンで選択可能
  - 日：過去7日まで選択可能（今日を含む）
  - 時刻：00:00 ～ 23:59の範囲
- **睡眠時間選択**
  - ドロップダウン形式で選択
  - 形式：HH:MM（例：01:30）
  - 分単位の粒度：5分単位
  - 範囲：00:00 ～ 23:55（5分刻み）
- **登録ボタン**
  - 「記録する」ボタンで登録実行
  - バリデーション：必須項目の入力チェック

#### 3.1.2 記録の種類判定
- **夜の睡眠**：22時以降から07時までに入眠した睡眠
- **昼の睡眠**：それ以外の時間帯に入眠した睡眠
- 判定は内部的に自動実行（ユーザーは明示的に選択しない）

#### 3.1.3 記録の修正機能
- 過去の記録を編集可能
- 「過去記録一覧」画面から編集を開始
- 該当レコードをクリック/タップで編集モードに移行
- 編集は新規記録と同様のフォームを使用
- 「保存」ボタンで編集内容を保存

### 3.2 睡眠履歴表示機能

#### 3.2.1 昨日・今日の記録表示
- 表形式で表示
- 表示項目：
  - 入眠日時
  - 睡眠時間
- 複数の睡眠記録がある場合は全て表示

#### 3.2.2 過去記録の一覧表示
- 「過去記録一覧」画面を用意
- 過去の記録を時系列または日付順で一覧表示
- 表示項目：入眠日時、睡眠時間、睡眠の種類（夜/昼）等
- 各レコードをクリック/タップで編集モードに移行

### 3.3 統計・分析機能

#### 3.3.1 グラフ表示
- **集計期間**
  - 週次表示（デフォルト）
  - 月次表示
  - 週次/月次の切り替えをタブまたはボタンで実現
- **グラフ形式**
  - 積層グラフ（Stacked Bar Chart）
  - 昼寝：オレンジ色で表示
  - 夜の睡眠：濃い青色で表示
- **表示内容**
  - 日別の睡眠時間を積層で表示
  - 週次：週ごとの日別データ
  - 月次：月ごとの日別データまたは週次データ

### 3.4 データエクスポート機能
- **ダウンロードボタン**
  - 画面上部に配置
  - CSV形式でデータをダウンロード可能
- **CSVデータ形式**
  - 全睡眠記録を含む
  - 列：ID、開始日時、睡眠時間(時間)、睡眠時間(分)、睡眠の種類、作成日時、更新日時
- **ファイル名形式**
  - `RecSleep_export_YYYYMMDD.csv`（例：RecSleep_export_20250106.csv）
- **日時フォーマット**
  - CSV内の日時フォーマット：`YYYY-MM-DD HH:MM:SS`（例：2025-01-06 14:30:00）

## 4. UI/UX要件

### 4.1 基本方針
- 昼寝も考慮し、1日で数回寝る事（記録する事）を想定したUI設計
- スマートフォンでの操作性を最優先
- シンプルで直感的な操作を実現

### 4.2 画面レイアウト（上部から順）

#### 4.2.1 タイトル
- アプリ名「RecSleep」を上部に配置

#### 4.2.2 週次/月次グラフ
- タイトル直下に配置
- 週次/月次の切り替えUIをグラフ上部に配置
- 積層グラフを表示

#### 4.2.3 昨日・今日の睡眠記録表
- グラフの下に配置
- 表形式で入眠日時と睡眠時間を表示
- 複数件の場合は全て表示

#### 4.2.4 入力フォーム
- 画面下部に1行で配置
- コンパクトなレイアウトで必要な項目を並べて表示
- 睡眠開始日時（DD日 HH:MM）、睡眠時間（HH:MM）、記録するボタンを配置

#### 4.2.5 ダウンロードボタン
- 画面上部（タイトル付近）に配置
- 「ダウンロード」または「CSV出力」などのラベル

#### 4.2.6 過去記録一覧画面
- 別画面またはモーダルとして実装
- 画面遷移方法：メイン画面から遷移可能なリンク/ボタンを配置
- 過去の記録を一覧表示
- 各レコードをクリック/タップで編集モードに移行

## 5. データ構造

### 5.1 保存データ形式

#### 5.1.1 ローカルストレージ形式
```javascript
{
  sleepRecords: [
    {
      id: string,              // 一意のID（UUIDまたはタイムスタンプベース）
      startDateTime: string,    // ISO形式の日時文字列（例：2025-01-06T14:30:00）
      sleepDuration: {         // 睡眠時間
        hours: number,         // 時間
        minutes: number        // 分
      },
      sleepType: 'night' | 'day',  // 睡眠の種類（夜/昼）
      createdAt: string,       // 作成日時（ISO形式）
      updatedAt: string        // 更新日時（ISO形式）
    }
  ]
}
```

#### 5.1.2 CSV出力形式
```csv
ID,開始日時,睡眠時間(時間),睡眠時間(分),睡眠の種類,作成日時,更新日時
abc123,2025-01-06 14:30:00,1,30,day,2025-01-06 15:00:00,2025-01-06 15:00:00
```
- 日時フォーマット：`YYYY-MM-DD HH:MM:SS`（例：2025-01-06 14:30:00）

### 5.2 睡眠の種類判定ロジック
- 開始日時の時刻部分を抽出
- 22:00 ～ 07:00（翌日）の範囲：`night`（夜の睡眠）
- それ以外：`day`（昼の睡眠）
- 日をまたぐ睡眠は開始時刻で判定

## 6. 非機能要件

### 6.1 パフォーマンス
- スマートフォンでの快適な動作を保証
- グラフの描画は適切なライブラリを使用（Chart.js等を検討）

### 6.2 レスポンシブ対応
- スマートフォン画面サイズに最適化
- 縦向き表示を前提とする

### 6.3 データ保持
- ローカルストレージの容量制限を考慮（通常5-10MB）
- データ量が増えた場合の処理を考慮

## 7. 制約・前提

### 7.1 技術的制約
- サーバーサイド不要
- オフライン動作可能
- データはローカルストレージに保存（ブラウザをクリアするとデータも消える）
- JavaScriptライブラリは軽量なものを選択

### 7.2 ブラウザ互換性
- 主要モバイルブラウザ（Safari、Chrome、Edge）で動作確認
- LocalStorage APIに対応したブラウザを前提

## 8. 実装に関する詳細

### 8.1 日時の選択範囲
- **睡眠開始日時**
  - 日：過去7日まで選択可能（今日を含む）
  - 時刻：00:00 ～ 23:59の範囲
- **睡眠時間**
  - 分単位の粒度：5分単位
  - 範囲：00:00 ～ 23:55（5分刻みで選択可能）

### 8.2 グラフ表示の詳細
- 週次グラフ：直近1週間のデータを表示
- 月次グラフ：直近1ヶ月のデータを表示
- データがない日は0時間として表示
- グラフライブラリ：Chart.js等を検討（軽量なものを選択）

### 8.3 過去記録の編集方法
- 「過去記録一覧」画面から編集を開始
- 該当レコードをクリック/タップで編集モードに移行
- 編集フォームは新規記録と同様（同じUIコンポーネントを使用）
- 「保存」ボタンで編集内容を保存
- 編集画面はモーダルまたは別画面として実装

### 8.4 CSVダウンロードの詳細
- ファイル名形式：`RecSleep_export_YYYYMMDD.csv`（例：RecSleep_export_20250106.csv）
- CSV内の日時フォーマット：`YYYY-MM-DD HH:MM:SS`（例：2025-01-06 14:30:00）
- 全睡眠記録を出力

## 9. 未決・検討事項

### 9.1 UI/UXについて
- グラフのライブラリ：Chart.js、D3.js、その他の選択（軽量なものを優先）
- 過去記録一覧画面の遷移方法：メイン画面からの遷移方法を詳細設計時に決定
- 編集フォームの表示方法：モーダル vs 別画面（実装時に決定）

### 9.2 データ管理について
- データのバックアップ：ローカルストレージ以外の保持方法（将来拡張）

## 10. 今後の展開
- 現時点では基本的な睡眠記録機能に焦点
- 将来的な拡張機能は要件定義後に検討

---

**作成日**：2025年1月
**バージョン**：1.0（要件定義完了）
**状態**：要件定義完了

