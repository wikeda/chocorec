<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="トレーニングの回数を記録するアプリ">
  <title>TrainingRec - トレーニング記録</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/components.css">
</head>

<body>
  <header class="header">
    <h1>TrainingRec</h1>
    <div class="header-buttons">
      <a href="exercises.html" class="btn-exercises">種目</a>
      <a href="history.html" class="btn-history">履歴</a>
    </div>
  </header>

  <main class="main">
    <!-- グラフセクション -->
    <section class="chart-section">
      <div class="chart-header">
        <div class="chart-controls">
          <button id="week-prev-btn" class="btn-nav" onclick="moveWeekBackward()">←</button>
          <span id="week-label" class="period-label">今週</span>
          <button id="month-prev-btn" class="btn-nav hidden" onclick="moveMonthBackward()">←</button>
          <span id="month-label" class="period-label hidden">今月</span>
        </div>
        <div class="total-count-display">
          <span id="total-count-value" class="total-count-value">0</span>
          <span class="total-count-unit">pw</span>
        </div>
        <div class="chart-tabs">
          <button id="week-tab" class="tab active">週次</button>
          <button id="month-tab" class="tab">月次</button>
        </div>
      </div>
      <div id="chart-container" class="chart-container">
        <canvas id="training-chart"></canvas>
      </div>
    </section>

    <!-- 入力フォーム -->
    <section class="input-form">
      <form id="training-form">
        <!-- 日付・種目選択 -->
        <div class="form-group">
          <label class="form-label">日付・種目</label>
          <div class="form-group-row">
            <select id="date-select" name="date" class="form-select" required>
              <!-- 過去7日を動的に生成 -->
            </select>
            <select id="exercise-select" name="exercise" class="form-select" required>
              <!-- constants.jsから動的に生成 -->
            </select>
          </div>
        </div>

        <!-- 回数・セット数・重さ（任意） -->
        <div class="form-group">
          <label class="form-label">回数・セット数・重さ（任意）</label>
          <div class="form-group-row">
            <select id="count" name="count" class="form-select" required>
              <!-- JavaScriptで生成 -->
            </select>
            <span class="separator">×</span>
            <select id="sets" name="sets" class="form-select" required>
              <!-- JavaScriptで生成 -->
            </select>
            <span class="separator">×</span>
            <select id="weight" name="weight" class="form-select">
              <!-- JavaScriptで生成 -->
            </select>
            <span class="form-unit">kg</span>
          </div>
        </div>

        <!-- 記録ボタン -->
        <button type="submit" class="btn-submit">記録する</button>
      </form>
    </section>
  </main>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- JavaScript -->
  <script src="js/exerciseMaster.js"></script>
  <script src="js/constants.js"></script>
  <script src="js/data.js"></script>
  <script src="js/validator.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/export.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Chart.jsの読み込み完了を待ってからアプリを初期化
    window.addEventListener('DOMContentLoaded', function () {
      if (typeof Chart !== 'undefined' && typeof initApp === 'function') {
        initApp();
      } else {
        // Chart.jsが読み込まれるまで待つ
        const checkChart = setInterval(function () {
          if (typeof Chart !== 'undefined' && typeof initApp === 'function') {
            clearInterval(checkChart);
            initApp();
          }
        }, 50);

        // タイムアウト（5秒後）
        setTimeout(function () {
          clearInterval(checkChart);
          if (typeof Chart === 'undefined') {
            console.error('Chart.js failed to load');
          } else if (typeof initApp === 'function') {
            initApp();
          } else {
            console.error('initApp is not defined');
          }
        }, 5000);
      }
    });
  </script>
</body>

</html>